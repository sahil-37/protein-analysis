<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protein Report: P01308</title>
    
    <script type="importmap">
    {
      "imports": {
        "@nightingale-elements/": "https://cdn.jsdelivr.net/npm/@nightingale-elements/"
      }
    }
    </script>

    <!-- Chart.js for charge profile visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        :root {
            --primary-600: #4F46E5;
            --primary-700: #4338CA;
            --primary-50: #EEF2FF;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-900: #111827;
            --success-500: #10B981;
            --warning-500: #F59E0B;
            --error-500: #EF4444;
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            --font-mono: 'SF Mono', 'Monaco', 'Consolas', monospace;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-sans);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
            padding: var(--space-8);
        }
        
        .page-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .report-card {
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
            padding: var(--space-8);
        }
        
        .header-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .protein-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            font-family: var(--font-mono);
            backdrop-filter: blur(10px);
        }
        
        .header-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 400;
        }
        
        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            padding: var(--space-6);
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
        }
        
        .stat-card {
            background: white;
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .stat-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray-600);
            margin-bottom: var(--space-2);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        .stat-unit {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 400;
            margin-left: var(--space-1);
        }
        
        .content-wrapper {
            padding: var(--space-8);
        }
        
        .section {
            margin-bottom: var(--space-8);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 2px solid var(--gray-200);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        .section-description {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-top: var(--space-2);
        }

        /* Sequence Display */
        .sequence-section {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin: var(--space-6) 0;
            box-shadow: var(--shadow-sm);
            width: 100%;
        }

        .sequence-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--space-3);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sequence-display {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            font-family: monospace;
            font-size: 0.875rem;
            color: var(--gray-800);
            line-height: 1.6;
            word-wrap: break-word;
            white-space: pre-wrap;
            overflow-x: auto;
            width: 100%;
            box-sizing: border-box;
        }

        /* Properties Grid */
        .properties-grid {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
            margin-top: var(--space-4);
        }

        .property-group {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            box-shadow: var(--shadow-sm);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--space-4);
        }

        .property-group.horizontal-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-4);
        }

        .property-group.secondary-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
        }

        /* Post-Translational Modifications Section */
        .ptm-section {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow-sm);
        }

        .ptm-section.ptm-empty {
            background: var(--gray-50);
            border-style: dashed;
        }

        .ptm-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-4);
            border-bottom: 2px solid var(--gray-200);
        }

        .ptm-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .ptm-count {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .ptm-overview {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
            padding: var(--space-4);
            background: var(--gray-50);
            border-radius: var(--radius-md);
        }

        .ptm-type-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            background: white;
            border: 1px solid var(--gray-200);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
        }

        .ptm-count-badge {
            background: var(--primary-100);
            color: var(--primary-700);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            font-weight: 700;
            font-size: 0.75rem;
        }

        .ptm-details {
            margin-top: var(--space-4);
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            background: white;
        }

        .ptm-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        /* Scrollbar styling */
        .ptm-details::-webkit-scrollbar {
            width: 8px;
        }

        .ptm-details::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: var(--radius-md);
        }

        .ptm-details::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: var(--radius-md);
        }

        .ptm-details::-webkit-scrollbar-thumb:hover {
            background: var(--gray-400);
        }

        .ptm-item {
            background: var(--gray-50);
            border-left: 3px solid var(--primary-600);
            padding: var(--space-4);
            border-radius: var(--radius-md);
            display: flex;
            gap: var(--space-4);
            align-items: flex-start;
        }

        .ptm-position {
            font-weight: 700;
            color: var(--primary-600);
            min-width: 80px;
            font-family: var(--font-mono);
            font-size: 0.875rem;
        }

        .ptm-info {
            flex: 1;
        }

        .ptm-type-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--primary-600);
            margin-bottom: var(--space-1);
        }

        .ptm-description {
            font-size: 0.875rem;
            color: var(--gray-700);
            line-height: 1.4;
        }

        .ptm-more-indicator {
            text-align: center;
            padding: var(--space-4);
            color: var(--gray-600);
            font-size: 0.875rem;
            font-style: italic;
            border-top: 1px dashed var(--gray-300);
            margin-top: var(--space-3);
        }

        /* Secondary Structure Comparison Table */
        .sec-struct-table-wrapper {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-top: var(--space-4);
            box-shadow: var(--shadow-sm);
        }

        .sec-struct-comparison {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .sec-struct-comparison thead {
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-50) 100%);
        }

        .sec-struct-comparison th {
            padding: var(--space-3) var(--space-4);
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 2px solid var(--gray-300);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
        }

        .sec-struct-comparison td {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }

        .sec-struct-comparison tbody tr:last-child td {
            border-bottom: none;
        }

        .sec-struct-comparison tbody tr:hover {
            background: var(--gray-50);
        }

        .sec-struct-comparison td:first-child {
            font-weight: 500;
            color: var(--gray-800);
            width: 40%;
        }

        .sec-struct-comparison .pred-value {
            text-align: center;
            color: var(--primary-600);
            font-weight: 600;
        }

        .sec-struct-comparison .exp-value {
            text-align: center;
            color: var(--success-600);
            font-weight: 600;
        }

        .property-group-title {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--primary-600);
            margin-bottom: var(--space-3);
            padding-bottom: var(--space-2);
            border-bottom: 2px solid var(--primary-100);
        }

        .property-item {
            margin-bottom: var(--space-4);
        }

        .property-item:last-child {
            margin-bottom: 0;
        }

        .property-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray-600);
            margin-bottom: var(--space-1);
        }

        .property-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            font-family: var(--font-mono);
        }

        .property-unit {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 400;
            margin-left: var(--space-1);
        }

        /* Legacy table support */
        .properties-table {
            width: 100%;
            max-width: 700px;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .properties-table th {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
            color: white;
            font-weight: 600;
            text-align: left;
            padding: var(--space-4);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .properties-table td {
            padding: var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }

        .properties-table tr:last-child td {
            border-bottom: none;
        }

        .properties-table tr:nth-child(even) {
            background: var(--gray-50);
        }

        .properties-table td:first-child {
            font-weight: 600;
            color: var(--gray-700);
        }

        .properties-table td:last-child {
            color: var(--gray-900);
            font-family: var(--font-mono);
            font-size: 0.9375rem;
        }
        
        .viewer-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
            position: relative;
        }
        

        /* Charge Profile Chart */
        .charge-profile-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-6);
        }

        .charge-profile-container {
            position: relative;
            height: 400px;
            margin-bottom: var(--space-4);
        }

        .charge-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
        }

        .charge-stat {
            background: var(--gray-50);
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
        }

        .charge-stat-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray-600);
            margin-bottom: var(--space-2);
        }

        .charge-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-600);
        }

        .charge-stat-unit {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 400;
            margin-left: var(--space-1);
        }

        /* Track Table */
        .track-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .track-table tr {
            border-bottom: 1px solid var(--gray-100);
        }
        
        .track-table tr:last-child {
            border-bottom: none;
        }
        
        .track-table td {
            padding: var(--space-3) var(--space-2);
        }
        
        .track-label-cell {
            width: 160px;
            padding-right: var(--space-4);
            border-right: 2px solid var(--gray-200);
            background: var(--gray-50);
            vertical-align: middle;
        }
        
        .track-label-wrapper {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            position: relative;
        }
        
        .track-name {
            font-size: 0.8125rem;
            font-weight: 600;
            color: var(--gray-700);
            white-space: nowrap;
        }
        
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary-600);
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            cursor: help;
            flex-shrink: 0;
        }
        
        .track-tooltip {
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: var(--space-2);
            background: var(--gray-900);
            color: white;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 1000;
        }
        
        .info-icon:hover + .track-tooltip {
            opacity: 1;
        }
        
        .track-content {
            background: white;
        }
        
        .track-table tr:first-child .track-label-cell {
            background: transparent;
            border: none;
        }
        
        /* Make tracks hoverable */
        .track-content nightingale-track,
        .track-content nightingale-sequence,
        .track-content nightingale-colored-sequence {
            cursor: crosshair;
        }

        /* Styling for overlapping PTM features in Nightingale tracks */
        .track-content nightingale-track svg.container {
            /* Increase height to accommodate staggered PTMs */
            height: auto !important;
        }
        
        /* Collapsible Sections */
        .collapsible-section {
            margin-bottom: var(--space-6);
        }

        .collapsible-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4) var(--space-6);
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--gray-50) 100%);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }

        .collapsible-section.collapsed .collapsible-header {
            border-radius: var(--radius-lg);
        }

        .collapsible-header:hover {
            background: linear-gradient(135deg, var(--primary-100) 0%, var(--gray-100) 100%);
            box-shadow: var(--shadow-sm);
        }

        .collapsible-title-group {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            flex: 1;
        }

        .collapsible-toggle {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            font-size: 1.2rem;
            color: var(--primary-600);
            transition: transform 0.2s ease;
        }

        .collapsible-section.collapsed .collapsible-toggle {
            transform: rotate(-90deg);
        }

        .collapsible-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .collapsible-status {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--gray-600);
            padding: var(--space-2) var(--space-3);
            background: white;
            border-radius: var(--radius-sm);
            border: 1px solid var(--gray-200);
        }

        .collapsible-content {
            border: 1px solid var(--gray-200);
            border-top: none;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            overflow: hidden;
            max-height: 1000px;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .collapsible-section.collapsed .collapsible-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        .collapsible-body {
            padding: var(--space-6);
            background: white;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @media (max-width: 768px) {
            body {
                padding: var(--space-4);
            }
            
            .header-title {
                font-size: 1.5rem;
                flex-direction: column;
                align-items: flex-start;
            }
            
            .metadata-grid {
                grid-template-columns: 1fr;
            }
            
            .content-wrapper {
                padding: var(--space-4);
            }
            
            .track-label-cell {
                width: 100px;
            }
            
            .track-name {
                font-size: 0.75rem;
            }
        }
        
        @media print {
            body {
                background: white;
            }
            
            .report-card {
                box-shadow: none;
            }
            
            .info-icon, .track-tooltip {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="report-card">
            <div class="header">
                <h1 class="header-title">
                    üß¨ Protein Analysis Report
                    <span class="protein-badge">P01308</span>
                </h1>
                <p class="header-subtitle">Comprehensive biophysical and structural analysis</p>
            </div>
            
            <div class="metadata-grid">
                <div class="stat-card">
                    <div class="stat-label">Protein Name</div>
                    <div class="stat-value">Insulin</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Gene Name</div>
                    <div class="stat-value">INS</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Organism of Origin</div>
                    <div class="stat-value">Homo sapiens</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">UniProt Accession</div>
                    <div class="stat-value">P01308</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Sequence Length</div>
                    <div class="stat-value">
                        110
                        <span class="stat-unit">amino acids</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Annotated Features</div>
                    <div class="stat-value">
                        <span id="feature-count">0</span>
                        <span class="stat-unit">from UniProt</span>
                    </div>
                </div>
            </div>

            <!-- Amino Acid Sequence Section -->
            <div class="sequence-section">
                <div class="sequence-label">Amino Acid Sequence:</div>
                <div class="sequence-display" id="aa-sequence"></div>
            </div>

            <div class="content-wrapper">
                <div class="collapsible-section" id="biophysical-properties-section">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <div class="collapsible-title-group">
                            <span class="collapsible-toggle">‚ñº</span>
                            <div>
                                <div class="collapsible-title">Biophysical Properties</div>
                                <p class="section-description">Calculated using BioPython ProtParam with Bjellqvist pKa values</p>
                            </div>
                        </div>
                        <div class="collapsible-status">Level 1 ‚Ä¢ Essential</div>
                    </div>
                    <div class="collapsible-content">
                        <div class="collapsible-body">
                            
        <table class="properties-table">
            <tr><td>Molecular Weight</td><td>0.00 Da</td></tr>
            <tr><td>Isoelectric Point</td><td>5.22</td></tr>
            <tr><td>GRAVY Score</td><td>0.1927</td></tr>
            <tr><td>Aromaticity</td><td>0.0000</td></tr>
            <tr><td>Instability Index</td><td>40.33</td></tr>
            <tr><td>Cysteine Count</td><td>6</td></tr>
        </table>
        
                        </div>
                    </div>
                </div>

                <div class="collapsible-section" id="charge-profile-section">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <div class="collapsible-title-group">
                            <span class="collapsible-toggle">‚ñº</span>
                            <div>
                                <div class="collapsible-title">pH-Dependent Charge Profile</div>
                                <p class="section-description">Net charge of the protein across pH range 2.0 - 12.0</p>
                            </div>
                        </div>
                        <div class="collapsible-status">Level 2 ‚Ä¢ Advanced</div>
                    </div>
                    <div class="collapsible-content">
                        <div class="collapsible-body">
                            <div class="charge-profile-card">
                                <div class="charge-profile-container">
                                    <canvas id="charge-profile-chart"></canvas>
                                </div>

                                <div class="charge-stats">
                                    <div class="charge-stat">
                                        <div class="charge-stat-label">Isoelectric Point (pI)</div>
                                        <div class="charge-stat-value">
                                            <span id="pi-value">-</span>
                                            <span class="charge-stat-unit">pH</span>
                                        </div>
                                    </div>
                                    <div class="charge-stat">
                                        <div class="charge-stat-label">Charge at pH 7.4 (Physiological)</div>
                                        <div class="charge-stat-value">
                                            <span id="charge-74-value">-</span>
                                            <span class="charge-stat-unit">e‚Åª</span>
                                        </div>
                                    </div>
                                    <div class="charge-stat">
                                        <div class="charge-stat-label">Charge Range</div>
                                        <div class="charge-stat-value">
                                            <span id="charge-min-value">-</span>
                                            <span class="charge-stat-unit">to</span>
                                            <span id="charge-max-value">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="collapsible-section" id="protein-viewer-section">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <div class="collapsible-title-group">
                            <span class="collapsible-toggle">‚ñº</span>
                            <div>
                                <div class="collapsible-title">Interactive Protein Viewer</div>
                                <p class="section-description">Hover over colored features to see position, length, and Feature ID</p>
                            </div>
                        </div>
                        <div class="collapsible-status">Level 2 ‚Ä¢ Advanced</div>
                    </div>
                    <div class="collapsible-content">
                        <div class="collapsible-body">
                            <div class="viewer-card">
                        <nightingale-manager id="viewer-manager">
                            <table class="track-table">
                                <tbody>
                                    <tr>
                                        <td class="track-label-cell"></td>
                                        <td class="track-content">
                                            <nightingale-navigation id="navigation" min-width="900" height="40" length="110" display-start="1" display-end="110" margin-color="white"></nightingale-navigation>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Sequence</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Amino acid letters (one-letter code)</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-sequence id="sequence" min-width="900" height="40" length="110" display-start="1" display-end="110" margin-color="white" highlight-event="onmouseover"></nightingale-sequence>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Hydrophobicity</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Kyte-Doolittle scale: Blue=polar, Red=nonpolar</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-colored-sequence id="colored-sequence" min-width="900" height="20" length="110" display-start="1" display-end="110" scale="hydrophobicity-scale" margin-color="white" highlight-event="onmouseover"></nightingale-colored-sequence>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Chain</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Mature protein after signal peptide cleavage</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-track id="chain" layout="non-overlapping" min-width="900" height="20" length="110" display-start="1" display-end="110" margin-color="white" highlight-event="onmouseover"></nightingale-track>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Domain</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Conserved functional/structural domains</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-track id="domain" min-width="900" height="20" length="110" display-start="1" display-end="110" margin-color="white" highlight-event="onmouseover"></nightingale-track>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Region</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Regions of interest (disordered, coiled-coil, etc.)</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-track id="region" min-width="900" height="20" length="110" display-start="1" display-end="110" margin-color="white" highlight-event="onmouseover"></nightingale-track>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Site</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Functionally important sites (active site, etc.)</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-track id="site" min-width="900" height="20" length="110" display-start="1" display-end="110" margin-color="white" highlight-event="onmouseover"></nightingale-track>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Binding Site</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Residues involved in ligand/substrate binding</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-track id="binding" min-width="900" height="20" length="110" display-start="1" display-end="110" margin-color="white" highlight-event="onmouseover"></nightingale-track>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Disulfide Bond</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Cysteine pairs forming S-S bridges</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-track id="disulfide-bond" layout="non-overlapping" min-width="900" height="20" length="110" display-start="1" display-end="110" margin-color="white" highlight-event="onmouseover"></nightingale-track>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Beta Strand</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Œ≤-sheet secondary structure elements</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-track id="beta-strand" min-width="900" height="20" length="110" display-start="1" display-end="110" margin-color="white" highlight-event="onmouseover"></nightingale-track>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Helix</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Œ±-helix secondary structure elements</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-track id="helix" min-width="900" height="20" length="110" display-start="1" display-end="110" margin-color="white" highlight-event="onmouseover"></nightingale-track>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Turn</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Œ≤-turn secondary structure elements</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-track id="turn" min-width="900" height="20" length="110" display-start="1" display-end="110" margin-color="white" highlight-event="onmouseover"></nightingale-track>
                                        </td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="track-label-cell">
                                            <div class="track-label-wrapper">
                                                <span class="track-name">Modified Residue</span>
                                                <span class="info-icon">i</span>
                                                <span class="track-tooltip">Post-translational modifications (PTMs)</span>
                                            </div>
                                        </td>
                                        <td class="track-content">
                                            <nightingale-track id="mod-res" layout="non-overlapping" min-width="900" height="50" length="110" display-start="1" display-end="110" margin-color="white" highlight-event="onmouseover"></nightingale-track>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </nightingale-manager>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Collapsible PTM Section -->
                <div class="collapsible-section" id="ptm-description-section">
                    <div class="collapsible-header" onclick="toggleCollapsible(this)">
                        <div class="collapsible-title-group">
                            <span class="collapsible-toggle">‚ñº</span>
                            <div>
                                <div class="collapsible-title">Post-Translational Modifications</div>
                                <p class="section-description">Detailed PTM information and descriptions</p>
                            </div>
                        </div>
                        <div class="collapsible-status">Level 2 ‚Ä¢ Advanced</div>
                    </div>
                    <div class="collapsible-content">
                        <div class="collapsible-body">
                            <div class="ptm-types"><div class="ptm-type-item">DISULFID: 3</div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Collapsible section toggle script -->
    <script>
        // Global toggle function for collapsible sections
        window.toggleCollapsible = function(header) {
            const section = header.closest('.collapsible-section');
            if (section) {
                const isCollapsed = section.classList.toggle('collapsed');
                console.log('Toggled section:', section.id, '- now collapsed:', isCollapsed);
            }
        };

        // Initialize all collapsible sections as expanded by default
        document.addEventListener('DOMContentLoaded', function() {
            // Keep Level 2 sections collapsed initially (Advanced)
            const chargeProfileSection = document.getElementById('charge-profile-section');
            const proteinViewerSection = document.getElementById('protein-viewer-section');
            const ptmDescriptionSection = document.getElementById('ptm-description-section');

            if (chargeProfileSection) {
                chargeProfileSection.classList.add('collapsed');
                console.log('Collapsed charge-profile-section');
            }
            if (proteinViewerSection) {
                proteinViewerSection.classList.add('collapsed');
                console.log('Collapsed protein-viewer-section');
            }
            if (ptmDescriptionSection) {
                ptmDescriptionSection.classList.add('collapsed');
                console.log('Collapsed ptm-description-section');
            }
        });
    </script>

    <script type="module">
        import "@nightingale-elements/nightingale-sequence@latest";
        import "@nightingale-elements/nightingale-track@latest";
        import "@nightingale-elements/nightingale-manager@latest";
        import "@nightingale-elements/nightingale-navigation@latest";
        import "@nightingale-elements/nightingale-colored-sequence@latest";

        const sequence = "MALWMRLLPLLALLALWGPDPAAAFVNQHLCGSHLVEALYLVCGERGFFYTPKTRREAEDLQVGQVELGGGPGAGSLQPLALEGSLQKRGIVEQCCTSICSLYQLENYCN";
        const features = [{"type": "SIGNAL", "category": "MOLECULE_PROCESSING", "description": "", "begin": "1", "end": 24, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "14426955", "url": "http://www.ncbi.nlm.nih.gov/pubmed/14426955", "alternativeUrl": "https://europepmc.org/abstract/MED/14426955"}}], "start": 1, "title": "\nPosition: 1-24 aa\nSize: 24 aa"}, {"type": "PEPTIDE", "category": "MOLECULE_PROCESSING", "ftId": "PRO_0000015819", "description": "Insulin B chain", "begin": "25", "end": 54, "molecule": "", "start": 25, "title": "Insulin B chain\nPosition: 25-54 aa\nSize: 30 aa"}, {"type": "PROPEP", "category": "MOLECULE_PROCESSING", "ftId": "PRO_0000015820", "description": "C peptide", "begin": "57", "end": 87, "molecule": "", "start": 57, "title": "C peptide\nPosition: 57-87 aa\nSize: 31 aa"}, {"type": "PEPTIDE", "category": "MOLECULE_PROCESSING", "ftId": "PRO_0000015821", "description": "Insulin A chain", "begin": "90", "end": 110, "molecule": "", "start": 90, "title": "Insulin A chain\nPosition: 90-110 aa\nSize: 21 aa"}, {"type": "DISULFID", "category": "PTM", "description": "Interchain (between B and A chains)", "begin": "31", "end": 96, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "1433291", "url": "http://www.ncbi.nlm.nih.gov/pubmed/1433291", "alternativeUrl": "https://europepmc.org/abstract/MED/1433291"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "25423173", "url": "http://www.ncbi.nlm.nih.gov/pubmed/25423173", "alternativeUrl": "https://europepmc.org/abstract/MED/25423173"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "8421693", "url": "http://www.ncbi.nlm.nih.gov/pubmed/8421693", "alternativeUrl": "https://europepmc.org/abstract/MED/8421693"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1AI0", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1AI0"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1AIY", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1AIY"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1HIQ", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1HIQ"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1MHI", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1MHI"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "2MVC", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/2MVC"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "2MVD", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/2MVD"}}], "start": 31, "title": "Interchain (between B and A chains)\nPosition: 31-96 aa\nSize: 66 aa"}, {"type": "DISULFID", "category": "PTM", "description": "Interchain (between B and A chains)", "begin": "43", "end": 109, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "1433291", "url": "http://www.ncbi.nlm.nih.gov/pubmed/1433291", "alternativeUrl": "https://europepmc.org/abstract/MED/1433291"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "25423173", "url": "http://www.ncbi.nlm.nih.gov/pubmed/25423173", "alternativeUrl": "https://europepmc.org/abstract/MED/25423173"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "8421693", "url": "http://www.ncbi.nlm.nih.gov/pubmed/8421693", "alternativeUrl": "https://europepmc.org/abstract/MED/8421693"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1AI0", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1AI0"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1AIY", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1AIY"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1HIQ", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1HIQ"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1MHI", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1MHI"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "2MVC", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/2MVC"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "2MVD", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/2MVD"}}], "start": 43, "title": "Interchain (between B and A chains)\nPosition: 43-109 aa\nSize: 67 aa"}, {"type": "DISULFID", "category": "PTM", "description": "", "begin": "95", "end": 100, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "1433291", "url": "http://www.ncbi.nlm.nih.gov/pubmed/1433291", "alternativeUrl": "https://europepmc.org/abstract/MED/1433291"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "25423173", "url": "http://www.ncbi.nlm.nih.gov/pubmed/25423173", "alternativeUrl": "https://europepmc.org/abstract/MED/25423173"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "5101771", "url": "http://www.ncbi.nlm.nih.gov/pubmed/5101771", "alternativeUrl": "https://europepmc.org/abstract/MED/5101771"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "8421693", "url": "http://www.ncbi.nlm.nih.gov/pubmed/8421693", "alternativeUrl": "https://europepmc.org/abstract/MED/8421693"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "9235985", "url": "http://www.ncbi.nlm.nih.gov/pubmed/9235985", "alternativeUrl": "https://europepmc.org/abstract/MED/9235985"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1AI0", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1AI0"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1AIY", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1AIY"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1HIQ", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1HIQ"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "1MHI", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1MHI"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "2MVC", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/2MVC"}}, {"code": "ECO:0007744", "source": {"name": "PDB", "id": "2MVD", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/2MVD"}}], "start": 95, "title": "\nPosition: 95-100 aa\nSize: 6 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063721", "description": "in MODY10; dbSNP:rs121908278", "alternativeSequence": "C", "begin": "6", "end": 6, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 6, "title": "in MODY10; dbSNP:rs121908278\nPosition: 6-6 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063722", "description": "in MODY10; dbSNP:rs121908259", "alternativeSequence": "H", "begin": "6", "end": 6, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "20226046", "url": "http://www.ncbi.nlm.nih.gov/pubmed/20226046", "alternativeUrl": "https://europepmc.org/abstract/MED/20226046"}}], "start": 6, "title": "in MODY10; dbSNP:rs121908259\nPosition: 6-6 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063723", "description": "in PNDM4; dbSNP:rs80356663", "alternativeSequence": "D", "begin": "24", "end": 24, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "17855560", "url": "http://www.ncbi.nlm.nih.gov/pubmed/17855560", "alternativeUrl": "https://europepmc.org/abstract/MED/17855560"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 24, "title": "in PNDM4; dbSNP:rs80356663\nPosition: 24-24 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063724", "description": "in PNDM4; dbSNP:rs121908272", "alternativeSequence": "D", "begin": "29", "end": 29, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 29, "title": "in PNDM4; dbSNP:rs121908272\nPosition: 29-29 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063725", "description": "in PNDM4; dbSNP:rs80356664", "alternativeSequence": "R", "begin": "32", "end": 32, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "17855560", "url": "http://www.ncbi.nlm.nih.gov/pubmed/17855560", "alternativeUrl": "https://europepmc.org/abstract/MED/17855560"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 32, "title": "in PNDM4; dbSNP:rs80356664\nPosition: 32-32 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063726", "description": "in PNDM4; dbSNP:rs80356664", "alternativeSequence": "S", "begin": "32", "end": 32, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "17855560", "url": "http://www.ncbi.nlm.nih.gov/pubmed/17855560", "alternativeUrl": "https://europepmc.org/abstract/MED/17855560"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 32, "title": "in PNDM4; dbSNP:rs80356664\nPosition: 32-32 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_003971", "description": "in HPRI; Providence; dbSNP:rs121918101", "alternativeSequence": "D", "begin": "34", "end": 34, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "3470784", "url": "http://www.ncbi.nlm.nih.gov/pubmed/3470784", "alternativeUrl": "https://europepmc.org/abstract/MED/3470784"}}], "start": 34, "title": "in HPRI; Providence; dbSNP:rs121918101\nPosition: 34-34 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063727", "description": "in PNDM4; dbSNP:rs121908273", "alternativeSequence": "P", "begin": "35", "end": 35, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 35, "title": "in PNDM4; dbSNP:rs121908273\nPosition: 35-35 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063728", "description": "in PNDM4; dbSNP:rs80356666", "alternativeSequence": "G", "begin": "43", "end": 43, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "17855560", "url": "http://www.ncbi.nlm.nih.gov/pubmed/17855560", "alternativeUrl": "https://europepmc.org/abstract/MED/17855560"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 43, "title": "in PNDM4; dbSNP:rs80356666\nPosition: 43-43 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063729", "description": "in MODY10; reduces binding affinity to INSR; reduces biological activity; reduces folding properties; dbSNP:rs121908260", "alternativeSequence": "Q", "begin": "46", "end": 46, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18192540", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18192540", "alternativeUrl": "https://europepmc.org/abstract/MED/18192540"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "20226046", "url": "http://www.ncbi.nlm.nih.gov/pubmed/20226046", "alternativeUrl": "https://europepmc.org/abstract/MED/20226046"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "25423173", "url": "http://www.ncbi.nlm.nih.gov/pubmed/25423173", "alternativeUrl": "https://europepmc.org/abstract/MED/25423173"}}], "start": 46, "title": "in MODY10; reduces binding affinity to INSR; reduces biological activity; reduces folding properties; dbSNP:rs121908260\nPosition: 46-46 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063730", "description": "in PNDM4; dbSNP:rs80356667", "alternativeSequence": "V", "begin": "47", "end": 47, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "17855560", "url": "http://www.ncbi.nlm.nih.gov/pubmed/17855560", "alternativeUrl": "https://europepmc.org/abstract/MED/17855560"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 47, "title": "in PNDM4; dbSNP:rs80356667\nPosition: 47-47 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063731", "description": "in PNDM4; dbSNP:rs80356668", "alternativeSequence": "C", "begin": "48", "end": 48, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "17855560", "url": "http://www.ncbi.nlm.nih.gov/pubmed/17855560", "alternativeUrl": "https://europepmc.org/abstract/MED/17855560"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 48, "title": "in PNDM4; dbSNP:rs80356668\nPosition: 48-48 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_003972", "description": "in HPRI; Los-Angeles; dbSNP:rs80356668", "alternativeSequence": "S", "begin": "48", "end": 48, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "6312455", "url": "http://www.ncbi.nlm.nih.gov/pubmed/6312455", "alternativeUrl": "https://europepmc.org/abstract/MED/6312455"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "6424111", "url": "http://www.ncbi.nlm.nih.gov/pubmed/6424111", "alternativeUrl": "https://europepmc.org/abstract/MED/6424111"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "8421693", "url": "http://www.ncbi.nlm.nih.gov/pubmed/8421693", "alternativeUrl": "https://europepmc.org/abstract/MED/8421693"}}], "start": 48, "title": "in HPRI; Los-Angeles; dbSNP:rs80356668\nPosition: 48-48 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_003973", "description": "in Chicago; dbSNP:rs148685531", "alternativeSequence": "L", "begin": "49", "end": 49, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "6424111", "url": "http://www.ncbi.nlm.nih.gov/pubmed/6424111", "alternativeUrl": "https://europepmc.org/abstract/MED/6424111"}}], "start": 49, "title": "in Chicago; dbSNP:rs148685531\nPosition: 49-49 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063732", "description": "in T1D2; dbSNP:rs121908261", "alternativeSequence": "C", "begin": "55", "end": 55, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18192540", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18192540", "alternativeUrl": "https://europepmc.org/abstract/MED/18192540"}}], "start": 55, "title": "in T1D2; dbSNP:rs121908261\nPosition: 55-55 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063733", "description": "in dbSNP:rs121908279", "alternativeSequence": "M", "begin": "68", "end": 68, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 68, "title": "in dbSNP:rs121908279\nPosition: 68-68 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063734", "description": "in PNDM4; uncertain significance; dbSNP:rs121908274", "alternativeSequence": "R", "begin": "84", "end": 84, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 84, "title": "in PNDM4; uncertain significance; dbSNP:rs121908274\nPosition: 84-84 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063735", "description": "in PNDM4; dbSNP:rs80356669", "alternativeSequence": "C", "begin": "89", "end": 89, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "17855560", "url": "http://www.ncbi.nlm.nih.gov/pubmed/17855560", "alternativeUrl": "https://europepmc.org/abstract/MED/17855560"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 89, "title": "in PNDM4; dbSNP:rs80356669\nPosition: 89-89 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_003974", "description": "in HPRI; impairs post-translational cleavage; dbSNP:rs28933985", "alternativeSequence": "H", "begin": "89", "end": 89, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "2196279", "url": "http://www.ncbi.nlm.nih.gov/pubmed/2196279", "alternativeUrl": "https://europepmc.org/abstract/MED/2196279"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "4019786", "url": "http://www.ncbi.nlm.nih.gov/pubmed/4019786", "alternativeUrl": "https://europepmc.org/abstract/MED/4019786"}}], "start": 89, "title": "in HPRI; impairs post-translational cleavage; dbSNP:rs28933985\nPosition: 89-89 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_003975", "description": "in HPRI; Kyoto; dbSNP:rs28933985", "alternativeSequence": "L", "begin": "89", "end": 89, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "1601997", "url": "http://www.ncbi.nlm.nih.gov/pubmed/1601997", "alternativeUrl": "https://europepmc.org/abstract/MED/1601997"}}], "start": 89, "title": "in HPRI; Kyoto; dbSNP:rs28933985\nPosition: 89-89 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063736", "description": "in PNDM4; dbSNP:rs80356670", "alternativeSequence": "C", "begin": "90", "end": 90, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "17855560", "url": "http://www.ncbi.nlm.nih.gov/pubmed/17855560", "alternativeUrl": "https://europepmc.org/abstract/MED/17855560"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 90, "title": "in PNDM4; dbSNP:rs80356670\nPosition: 90-90 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_003976", "description": "in Wakayama; dbSNP:rs121918102", "alternativeSequence": "L", "begin": "92", "end": 92, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "3537011", "url": "http://www.ncbi.nlm.nih.gov/pubmed/3537011", "alternativeUrl": "https://europepmc.org/abstract/MED/3537011"}}], "start": 92, "title": "in Wakayama; dbSNP:rs121918102\nPosition: 92-92 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063737", "description": "in PNDM4; dbSNP:rs80356671", "alternativeSequence": "S", "begin": "96", "end": 96, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 96, "title": "in PNDM4; dbSNP:rs80356671\nPosition: 96-96 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063738", "description": "in PNDM4; dbSNP:rs80356671", "alternativeSequence": "Y", "begin": "96", "end": 96, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "17855560", "url": "http://www.ncbi.nlm.nih.gov/pubmed/17855560", "alternativeUrl": "https://europepmc.org/abstract/MED/17855560"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 96, "title": "in PNDM4; dbSNP:rs80356671\nPosition: 96-96 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063739", "description": "in PNDM4; dbSNP:rs121908276", "alternativeSequence": "C", "begin": "101", "end": 101, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 101, "title": "in PNDM4; dbSNP:rs121908276\nPosition: 101-101 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063740", "description": "in PNDM4; dbSNP:rs121908277", "alternativeSequence": "C", "begin": "103", "end": 103, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 103, "title": "in PNDM4; dbSNP:rs121908277\nPosition: 103-103 aa\nSize: 1 aa"}, {"type": "VARIANT", "category": "VARIANTS", "ftId": "VAR_063741", "description": "in PNDM4; dbSNP:rs80356672", "alternativeSequence": "C", "begin": "108", "end": 108, "molecule": "", "evidences": [{"code": "ECO:0000269", "source": {"name": "PubMed", "id": "17855560", "url": "http://www.ncbi.nlm.nih.gov/pubmed/17855560", "alternativeUrl": "https://europepmc.org/abstract/MED/17855560"}}, {"code": "ECO:0000269", "source": {"name": "PubMed", "id": "18162506", "url": "http://www.ncbi.nlm.nih.gov/pubmed/18162506", "alternativeUrl": "https://europepmc.org/abstract/MED/18162506"}}], "start": 108, "title": "in PNDM4; dbSNP:rs80356672\nPosition: 108-108 aa\nSize: 1 aa"}, {"type": "HELIX", "category": "STRUCTURAL", "begin": "25", "end": 27, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "8HSK", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/8HSK"}}], "start": 25, "title": "HELIX\nPosition: 25-27 aa\nSize: 3 aa"}, {"type": "HELIX", "category": "STRUCTURAL", "begin": "28", "end": 31, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "1AIY", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1AIY"}}], "start": 28, "title": "HELIX\nPosition: 28-31 aa\nSize: 4 aa"}, {"type": "HELIX", "category": "STRUCTURAL", "begin": "33", "end": 43, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "3W7Y", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/3W7Y"}}], "start": 33, "title": "HELIX\nPosition: 33-43 aa\nSize: 11 aa"}, {"type": "HELIX", "category": "STRUCTURAL", "begin": "44", "end": 46, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "3W7Y", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/3W7Y"}}], "start": 44, "title": "HELIX\nPosition: 44-46 aa\nSize: 3 aa"}, {"type": "STRAND", "category": "STRUCTURAL", "begin": "48", "end": 50, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "3W7Y", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/3W7Y"}}], "start": 48, "title": "STRAND\nPosition: 48-50 aa\nSize: 3 aa"}, {"type": "STRAND", "category": "STRUCTURAL", "begin": "56", "end": 58, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "1EFE", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1EFE"}}], "start": 56, "title": "STRAND\nPosition: 56-58 aa\nSize: 3 aa"}, {"type": "TURN", "category": "STRUCTURAL", "begin": "59", "end": 66, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "1T0C", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1T0C"}}], "start": 59, "title": "TURN\nPosition: 59-66 aa\nSize: 8 aa"}, {"type": "STRAND", "category": "STRUCTURAL", "begin": "74", "end": 76, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "1T0C", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1T0C"}}], "start": 74, "title": "STRAND\nPosition: 74-76 aa\nSize: 3 aa"}, {"type": "HELIX", "category": "STRUCTURAL", "begin": "79", "end": 81, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "1T0C", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1T0C"}}], "start": 79, "title": "HELIX\nPosition: 79-81 aa\nSize: 3 aa"}, {"type": "TURN", "category": "STRUCTURAL", "begin": "84", "end": 86, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "1T0C", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1T0C"}}], "start": 84, "title": "TURN\nPosition: 84-86 aa\nSize: 3 aa"}, {"type": "HELIX", "category": "STRUCTURAL", "begin": "91", "end": 97, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "3W7Y", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/3W7Y"}}], "start": 91, "title": "HELIX\nPosition: 91-97 aa\nSize: 7 aa"}, {"type": "STRAND", "category": "STRUCTURAL", "begin": "98", "end": 101, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "4EFX", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/4EFX"}}], "start": 98, "title": "STRAND\nPosition: 98-101 aa\nSize: 4 aa"}, {"type": "HELIX", "category": "STRUCTURAL", "begin": "102", "end": 106, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "3W7Y", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/3W7Y"}}], "start": 102, "title": "HELIX\nPosition: 102-106 aa\nSize: 5 aa"}, {"type": "TURN", "category": "STRUCTURAL", "begin": "107", "end": 109, "molecule": "", "evidences": [{"code": "ECO:0007829", "source": {"name": "PDB", "id": "1HIQ", "url": "https://www.ebi.ac.uk/pdbe-srv/view/entry/1HIQ"}}], "start": 107, "title": "TURN\nPosition: 107-109 aa\nSize: 3 aa"}];
        const sequenceLength = 110;
        const chargeProfileData = {"ph_values": [2.0, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9, 3.0, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8, 3.9, 4.0, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 5.0, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9, 6.0, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9, 7.0, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8, 7.9, 8.0, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9, 9.0, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9, 10.0, 10.1, 10.2, 10.3, 10.4, 10.5, 10.6, 10.7, 10.8, 10.9, 11.0, 11.1, 11.2, 11.3, 11.4, 11.5, 11.6, 11.7, 11.8, 11.9, 12.0], "charges": [9.926416391501599, 9.907690257553577, 9.884299835891284, 9.855139028254388, 9.818869022765282, 9.773884361579434, 9.71828141236127, 9.649833273763871, 9.565976249533513, 9.463813696428378, 9.340142882775698, 9.191509252316543, 9.01429046176795, 8.804810849423237, 8.559487296832721, 8.275010965202142, 7.948575033071668, 7.578161776822108, 7.162896300608893, 6.703453823484303, 6.202473757341544, 5.664895897238537, 5.098106855992395, 4.511785155269444, 3.917374229248704, 3.3271953245190957, 2.7533175975590236, 2.2063907892730033, 1.6946739429121944, 1.223443574150524, 0.7948577546016455, 0.4082366671943891, 0.06063988412201127, -0.2524059290495284, -0.5361579337683686, -0.7959785320710271, -1.036783504050499, -1.2626491190865323, -1.4765963795190782, -1.6805577889614174, -1.8755126554399641, -2.061750155739471, -2.239193591903632, -2.4077074155952936, -2.5673193633006584, -2.718321347675202, -2.8612526932642943, -2.996803289022382, -3.1256921114616665, -3.248575404579652, -3.3660216643721803, -3.478564417376827, -3.5868176131361817, -3.691620974241019, -3.794178931536278, -3.896165765402084, -3.9997848397829925, -4.107783376938326, -4.223430723193323, -4.3504665332468475, -4.493018240485998, -4.655478534188682, -4.842327335512297, -5.057882601643858, -5.305973422127071, -5.589549393687593, -5.910271113553284, -6.268160781411343, -6.661414805962078, -7.086473088498812, -7.538388944941249, -8.011454707889785, -8.499941115792758, -8.998748470837866, -9.503779041039827, -10.011925911036663, -10.52070146086933, -11.027650180142215, -11.529762904027727, -12.02310957479132, -12.502835277915214, -12.963542766287764, -13.399956643394354, -13.807678480254324, -14.18383032626246, -14.527443653018453, -14.839546843196075, -15.122991984852458, -15.382110690115347, -15.622293663016729, -15.849563364235816, -16.070172813721836, -16.29023198087847, -16.515345106408898, -16.750240893589073, -16.998392474624975, -17.26165193592382, -17.5399570539584, -17.831192339763987, -18.13128605440385, -18.434587892069455], "isoelectric_point": 5.218581199645995, "charge_at_ph_7_4": -3.794178931536278};

        console.log("=== Protein Report ===");
        console.log("Sequence:", sequence.length, "aa");
        console.log("Features:", features.length);

        document.getElementById('feature-count').textContent = features.length;

        // Initialize charge profile chart
        if (chargeProfileData && chargeProfileData.ph_values) {
            initializeChargeProfile(chargeProfileData);
        }
        
        await Promise.all([
            customElements.whenDefined('nightingale-sequence'),
            customElements.whenDefined('nightingale-colored-sequence'),
            customElements.whenDefined('nightingale-track'),
            customElements.whenDefined('nightingale-navigation'),
            customElements.whenDefined('nightingale-manager')
        ]);
        
        console.log("‚úì Components loaded");

        // Debug: Inspect Nightingale's rendered elements
        console.log("\n=== NIGHTINGALE DEBUG ===");
        const regionTrack = document.querySelector("#region");
        if (regionTrack) {
            console.log("Region track found:", regionTrack);
            console.log("Track properties:", {
                tagName: regionTrack.tagName,
                id: regionTrack.id,
                hasChildNodes: regionTrack.childNodes.length,
                hasSlot: !!regionTrack.querySelector('slot'),
                shadowRoot: !!regionTrack.shadowRoot
            });

            // Try to access shadow DOM
            if (regionTrack.shadowRoot) {
                const shadowElements = regionTrack.shadowRoot.querySelectorAll('*');
                console.log("Shadow DOM elements:", shadowElements.length);

                // Look for SVG or canvas elements
                const svgElements = regionTrack.shadowRoot.querySelectorAll('svg');
                const canvasElements = regionTrack.shadowRoot.querySelectorAll('canvas');
                console.log("SVG elements in shadow:", svgElements.length);
                console.log("Canvas elements in shadow:", canvasElements.length);

                if (svgElements.length > 0) {
                    console.log("Found SVG rendering - features are probably SVG rects/paths");
                }
            }
        }
        console.log("=== END DEBUG ===\n");

        document.querySelector("#sequence").data = sequence;
        document.querySelector("#colored-sequence").data = sequence;

        // Display sequence in the sequence section with line breaks for readability
        const aaSequenceDiv = document.getElementById('aa-sequence');
        if (aaSequenceDiv) {
            // Format sequence in groups of 50 characters per line for readability
            let formattedSequence = '';
            const chunkSize = 50;
            for (let i = 0; i < sequence.length; i += chunkSize) {
                formattedSequence += sequence.substring(i, i + chunkSize) + '\n';
            }
            aaSequenceDiv.textContent = formattedSequence.trim();
        }
        
        // Format features with tooltip information and handle overlapping PTMs
        let rawProcessedFeatures = features.map(ft => {
            const startStr = ft.start || ft.begin;
            const endStr = ft.end || startStr;
            // Convert to numbers for calculation
            const start = parseInt(startStr);
            const end = parseInt(endStr);
            const size = end - start + 1;
            const featureId = ft.ftId || 'N/A';
            const description = ft.description || ft.type || 'Unknown feature';

            // Map PTM types to display names for tooltip
            const ptmTypeNames = {
                'MOD_RES': 'Modified Residue',
                'CARBOHYD': 'Glycosylation',
                'DISULFID': 'Disulfide Bond',
                'CROSSLNK': 'Cross-link',
                'LIPID': 'Lipidation'
            };

            // Create tooltip text
            let tooltipText = `${description}\nPosition: ${start}-${end} aa\nSize: ${size} aa`;

            // Add PTM type if this is a PTM feature
            if (ft.category === 'PTM') {
                const ptmType = ptmTypeNames[ft.type] || ft.type;
                tooltipText += `\nPTM Type: ${ptmType}`;
            }

            tooltipText += `\nFeature ID: ${featureId}`;

            return {
                ...ft,
                start: start,
                end: end,
                title: tooltipText,
                tooltipContent: tooltipText,
                label: `${description} (${start}-${end})`,
                // These will be updated by assignOffsetForOverlappingPTMs
                rowOffset: 0,
                totalRowsAtPosition: 1
            };
        });

        // Function to detect overlapping PTM features and enhance tooltips
        // Nightingale's layout="non-overlapping" handles automatic vertical positioning
        function assignOffsetForOverlappingPTMs(features) {
            // Only apply tooltip enhancement to PTM features (MOD_RES, CARBOHYD, CROSSLNK, LIPID, DISULFID)
            const ptmFeatures = features.filter(f => f.category === 'PTM');
            const nonPTMFeatures = features.filter(f => f.category !== 'PTM');

            // Group PTM features by position (start position) to detect overlaps
            const featuresByPosition = {};
            ptmFeatures.forEach(f => {
                if (!featuresByPosition[f.start]) {
                    featuresByPosition[f.start] = [];
                }
                featuresByPosition[f.start].push(f);
            });

            // Enhance tooltips for PTM features that have overlapping features at same position
            ptmFeatures.forEach(f => {
                const featuresAtPosition = featuresByPosition[f.start];
                const offset = featuresAtPosition.indexOf(f);

                // Update tooltip to show if multiple PTMs at same position
                // Nightingale's layout="non-overlapping" will handle automatic vertical positioning
                if (featuresAtPosition.length > 1) {
                    f.title += `\n\n‚ö†Ô∏è  ${featuresAtPosition.length} PTMs at position ${f.start}`;
                    f.title += `\n[${offset + 1} of ${featuresAtPosition.length}]`;
                }
            });

            // Combine back
            return [...nonPTMFeatures, ...ptmFeatures];
        }

        const processedFeatures = assignOffsetForOverlappingPTMs(rawProcessedFeatures);
        
        // Helper function to get all PTM features EXCEPT disulfides
        function getAllPTMFeaturesExceptDisulfides(allFeatures) {
            // Map PTM feature types to display names
            const ptmTypeNames = {
                'MOD_RES': 'Modified Residue',
                'CARBOHYD': 'Glycosylation',
                'CROSSLNK': 'Cross-link',
                'LIPID': 'Lipidation'
            };

            const ptmFeatures = allFeatures.filter(feature => {
                // Get all PTMs EXCEPT DISULFID (which has its own track)
                return feature.category === 'PTM' && feature.type !== 'DISULFID';
            }).map(feature => ({
                ...feature,
                // Ensure type is set for display
                displayType: ptmTypeNames[feature.type] || feature.type,
                // Add ftId if not present
                ftId: feature.ftId || ''
            }));

            console.log(`getAllPTMFeaturesExceptDisulfides: Found ${ptmFeatures.length} PTM features (excluding DISULFID) from ${allFeatures.length} total features`);
            if (ptmFeatures.length > 0) {
                console.log('Sample PTM feature:', ptmFeatures[0]);
            }

            return ptmFeatures;
        }

        const trackMap = {
            'chain': 'CHAIN',
            'domain': 'DOMAIN',
            'region': 'REGION',
            'site': 'SITE',
            'binding': 'BINDING',
            'disulfide-bond': 'DISULFID',
            'beta-strand': 'STRAND',
            'helix': 'HELIX',
            'turn': 'TURN',
            'mod-res': 'PTM_NO_DISULFID'  // All PTMs except disulfides
        };

        // Store feature data for tooltip lookups
        const featuresByTrack = {};
        const svgElementToFeature = new Map();  // Map SVG elements to their feature data

        for (const [trackId, featureType] of Object.entries(trackMap)) {
            const track = document.querySelector(`#${trackId}`);
            if (track) {
                let filteredFeatures;

                // For PTM track, get all PTM features except disulfides
                if (featureType === 'PTM_NO_DISULFID') {
                    filteredFeatures = getAllPTMFeaturesExceptDisulfides(processedFeatures);
                } else {
                    // For other tracks, filter by specific type
                    filteredFeatures = processedFeatures.filter(({ type }) => type === featureType);
                }

                track.data = filteredFeatures;
                featuresByTrack[trackId] = filteredFeatures;

                console.log(`Track '${trackId}' (${featureType}): ${filteredFeatures.length} features`);

                // Debug: show sample of PTM features if this is the PTM track
                if (featureType === 'PTM' && filteredFeatures.length > 0) {
                    console.log(`  ‚Üí Sample PTM features:`, filteredFeatures.slice(0, 3));
                }

                // Find SVG elements in the track and attach tooltips to them
                const svg = track.querySelector('svg.container');
                if (svg) {
                    const featureGroups = svg.querySelectorAll('g.feature-group');
                    console.log(`  ‚Üí Found ${featureGroups.length} SVG feature elements`);

                    // Map each SVG feature group to its data
                    featureGroups.forEach((svgGroup, index) => {
                        const feature = filteredFeatures[index];
                        if (feature) {
                            svgElementToFeature.set(svgGroup, feature);

                            // Add hover listeners to SVG element
                            svgGroup.style.cursor = 'pointer';

                            svgGroup.addEventListener('mouseenter', (e) => {
                                if (feature.title) {
                                    showTooltip(e.clientX, e.clientY, feature.title);
                                }
                            });

                            svgGroup.addEventListener('mousemove', (e) => {
                                if (feature.title) {
                                    showTooltip(e.clientX, e.clientY, feature.title);
                                }
                            });

                            svgGroup.addEventListener('mouseleave', () => {
                                hideTooltip();
                            });
                        }
                    });
                } else {
                    console.warn(`  ‚Üí No SVG found in track '${trackId}'`);
                }
            }
        }

        // Tooltip display functions
        function showTooltip(clientX, clientY, text) {
            let tooltip = document.getElementById('feature-tooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.id = 'feature-tooltip';
                tooltip.style.cssText = `
                    position: fixed;
                    background: rgba(0,0,0,0.95);
                    color: white;
                    padding: 10px 14px;
                    border-radius: 6px;
                    font-size: 13px;
                    white-space: pre-line;
                    z-index: 10000;
                    pointer-events: none;
                    max-width: 350px;
                    line-height: 1.5;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                    font-family: monospace;
                `;
                document.body.appendChild(tooltip);
            }
            tooltip.textContent = text;
            tooltip.style.left = (clientX + 15) + 'px';
            tooltip.style.top = (clientY + 15) + 'px';
            tooltip.style.display = 'block';
        }

        function hideTooltip() {
            const tooltip = document.getElementById('feature-tooltip');
            if (tooltip) {
                tooltip.style.display = 'none';
            }
        }

        console.log("‚úì Report fully loaded");
        console.log("üí° Hover over colored features to see position, length, and Feature ID!");

        // Function to initialize charge profile chart
        function initializeChargeProfile(data) {
            const ctx = document.getElementById('charge-profile-chart');
            if (!ctx) {
                console.warn("Chart canvas not found");
                return;
            }

            const pi = data.isoelectric_point;
            const charge74 = data.charge_at_ph_7_4;
            const phValues = data.ph_values;
            const charges = data.charges;

            // Update stat cards
            document.getElementById('pi-value').textContent = pi.toFixed(2);
            document.getElementById('charge-74-value').textContent = charge74.toFixed(2);

            const minCharge = Math.min(...charges);
            const maxCharge = Math.max(...charges);
            document.getElementById('charge-min-value').textContent = minCharge.toFixed(2);
            document.getElementById('charge-max-value').textContent = maxCharge.toFixed(2);

            // Create Chart.js chart
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: phValues.map(ph => ph.toFixed(1)),
                    datasets: [
                        {
                            label: 'Net Charge',
                            data: charges,
                            borderColor: '#2E86AB',
                            backgroundColor: 'rgba(46, 134, 171, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 3,
                            pointBackgroundColor: '#2E86AB',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 1,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                font: { size: 12, weight: '600' },
                                color: '#374151',
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#2E86AB',
                            borderWidth: 1,
                            padding: 12,
                            titleFont: { size: 13, weight: 'bold' },
                            bodyFont: { size: 12 },
                            usePointStyle: true,
                            callbacks: {
                                title: (tooltipItems) => {
                                    return `pH: ${tooltipItems[0].label}`;
                                },
                                label: (tooltipItem) => {
                                    return `Net Charge: ${tooltipItem.parsed.y.toFixed(3)} e‚Åª`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'pH',
                                font: { size: 13, weight: 'bold' },
                                color: '#374151'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                drawBorder: true,
                                borderColor: '#D1D5DB'
                            },
                            ticks: {
                                color: '#6B7280',
                                font: { size: 11 }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Net Charge (e‚Åª)',
                                font: { size: 13, weight: 'bold' },
                                color: '#374151'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)',
                                drawBorder: true,
                                borderColor: '#D1D5DB'
                            },
                            ticks: {
                                color: '#6B7280',
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });

            console.log("‚úì Charge profile chart rendered");
        }
    </script>
</body>
</html>

    <!-- ADD THIS JUST BEFORE </body> tag for working tooltips -->
    <script>
    // Custom tooltip that definitely works
    (function() {
        const tooltip = document.createElement('div');
        tooltip.id = 'custom-feature-tooltip';
        tooltip.style.cssText = `
            position: fixed;
            background: rgba(17, 24, 39, 0.95);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-family: -apple-system, sans-serif;
            pointer-events: none;
            z-index: 100000;
            display: none;
            max-width: 320px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        `;
        document.body.appendChild(tooltip);

        let currentFeature = null;
        
        // Add listeners to all track elements
        setTimeout(() => {
            document.querySelectorAll('nightingale-track').forEach(track => {
                const trackElement = track;
                
                // Try to access shadow root for hover detection
                if (trackElement.shadowRoot) {
                    const svg = trackElement.shadowRoot.querySelector('svg');
                    if (svg) {
                        svg.addEventListener('mousemove', (e) => {
                            // Get all features for this track
                            const features = trackElement.data || [];
                            
                            // Simple hit detection - find if mouse is over any feature
                            // This is approximate but works
                            const rect = svg.getBoundingClientRect();
                            const x = e.clientX - rect.left;
                            const trackWidth = rect.width;
                            const trackLength = parseInt(trackElement.getAttribute('length')) || 100;
                            const position = Math.floor((x / trackWidth) * trackLength);
                            
                            // Find feature at this position
                            const feature = features.find(f => {
                                const start = f.start || f.begin || 0;
                                const end = f.end || start;
                                return position >= start && position <= end;
                            });
                            
                            if (feature && feature !== currentFeature) {
                                currentFeature = feature;
                                const start = feature.start || feature.begin || '?';
                                const end = feature.end || start;
                                const featureId = feature.ftId || feature.id || 'N/A';
                                const description = feature.description || feature.type || 'Unknown';
                                
                                tooltip.innerHTML = `
                                    <div style="font-weight: 600; margin-bottom: 8px; font-size: 14px; color: #93c5fd;">${description}</div>
                                    <div style="margin: 4px 0;"><strong>Position:</strong> ${start}-${end}</div>
                                    <div style="margin: 4px 0;"><strong>Length:</strong> ${end - start + 1} aa</div>
                                    <div style="margin: 4px 0;"><strong>Feature ID:</strong> ${featureId}</div>
                                `;
                                tooltip.style.display = 'block';
                                tooltip.style.left = (e.clientX + 15) + 'px';
                                tooltip.style.top = (e.clientY + 15) + 'px';
                            } else if (!feature) {
                                tooltip.style.display = 'none';
                                currentFeature = null;
                            }
                        });
                        
                        svg.addEventListener('mouseleave', () => {
                            tooltip.style.display = 'none';
                            currentFeature = null;
                        });
                        
                        // Update tooltip position on mouse move
                        svg.addEventListener('mousemove', (e) => {
                            if (tooltip.style.display === 'block') {
                                tooltip.style.left = (e.clientX + 15) + 'px';
                                tooltip.style.top = (e.clientY + 15) + 'px';
                            }
                        });
                    }
                }
            });
            
            console.log("‚úì Custom tooltip system activated");
        }, 2000); // Wait for tracks to fully render
    })();
    </script>